<html>

<head>
  <title>Testing</title>
  <script
  src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
</head>


<body>
  <canvas id="main"></canvas>
  <script>

  const width = 1000;
  const height = 1000;

  const cellWidth = 5;
  const gridWidth = 100;

  const octaves = 5;
  const persistence = 0.5;

  var grid = [];
  var smoothed = [];
  for (var i = 0; i < gridWidth; i++){
    smoothed.push([]);
  }


  //  Basic smoothing
  function smooth(x, y){

    corners = ( grid[x-1][y-1]+grid[x+1][y-1]+grid[x-1][y+1]+grid[x+1][y+1]
        ) / 16;
    sides = ( grid[x-1][y]+grid[x+1][y]+grid[x][y+1]+grid[x][y+1]
        ) / 8;
    centre = grid[x][y]/4;

    smoothed[x][y] = corners + sides + centre;
  }


  function randVector(){
    /*
    var angle = Math.random()*2*Math.PI;
    return {x: Math.cos(angle), y: Math.sin(angle)};
    */
    return Math.random();
  }

  function generatePerlin(){
    //  Init grid
    for (var x = 0; x < gridWidth; x++){
      var col = [];
      for (var y = 0; y < gridWidth; y++){
        col.push(randVector());
      }
      grid.push(col);
    }

    for (var x = 1; x < gridWidth-1; x++){
      for (var y = 1; y < gridWidth-1; y++){
        smooth(x, y);
      }
    }

  }
  function makeRGB(b){
    var n = Math.floor(b * 255);
    var s = n.toString();
    return "rgb(" + s + "," + s + "," + s + ")";
  }
  function drawPerlin(){

    var canvas = $("#main")[0];
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext("2d");

    for (var x = 0; x < gridWidth; x++){
      for (var y = 0; y < gridWidth; y++){
        ctx.translate(x*cellWidth, y*cellWidth);
        ctx.fillStyle = makeRGB(smoothed[x][y]);
        //console.log(makeRGB(grid[x][y]));
        //ctx.fillStyle = "black";
        ctx.fillRect(-cellWidth, -cellWidth, cellWidth, cellWidth);
        ctx.translate(-x*cellWidth, -y*cellWidth);
      }
    }
    //ctx.fillStyle = "black";
    //ctx.fillRect(0,0, 1000, 1000);
  }

  console.log("Working...");
  generatePerlin();
  console.log("Done");
  drawPerlin();
  console.log("Drawn");
  </script>
</body>


</html>
